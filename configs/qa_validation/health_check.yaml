# ============================================
# QA Validation - Data Health Check Thresholds
# ============================================
# Thresholds for preprocessing output data quality validation
# Source: thoughts/shared/research/2025-12-20_14-30_data_health_check_architecture.md
#
# Framework:
#   1. Completeness - Are required fields present?
#   2. Cleanliness - Is the noise removed?
#   3. Substance - Is the content meaningful?
#   4. Consistency - Is the data usable?

categories:
  identity_completeness:
    display_name: Identity Completeness
    description: Required identity fields validation (CIK, company name, SIC)

  data_cleanliness:
    display_name: Data Cleanliness
    description: Artifact-free content validation (no HTML, page numbers)

  content_substance:
    display_name: Content Substance
    description: Meaningful content validation (segment length, word count)

  domain_rules:
    display_name: Domain Rules
    description: SEC-specific business logic (duplicates, risk keywords)

thresholds:
  # -------------------------
  # Identity Completeness
  # -------------------------
  identity_completeness:
    cik_present_rate:
      display_name: CIK Present Rate
      metric_type: rate
      target: 1.0
      operator: ">="
      blocking: true
      description: All files must have CIK (Central Index Key)
      tags: [identity, schema, blocking, health_check]

    company_name_present_rate:
      display_name: Company Name Present Rate
      metric_type: rate
      target: 1.0
      operator: ">="
      blocking: true
      description: All files must have company name
      tags: [identity, schema, blocking, health_check]

    sic_code_present_rate:
      display_name: SIC Code Present Rate
      metric_type: rate
      target: 0.95
      operator: ">="
      warn_threshold: 0.90
      blocking: false
      description: 95% of files should have SIC code for sector analysis
      tags: [identity, schema, health_check]

  # -------------------------
  # Data Cleanliness
  # -------------------------
  data_cleanliness:
    html_artifact_rate:
      display_name: HTML Artifact Rate
      metric_type: rate
      target: 0.0
      operator: "=="
      blocking: true
      description: No HTML tags should remain in segment text
      tags: [cleanliness, blocking, health_check]

    page_number_artifact_rate:
      display_name: Page Number Artifact Rate
      metric_type: rate
      target: 0.0
      operator: "=="
      warn_threshold: 0.01
      blocking: false
      description: No page number artifacts should remain
      tags: [cleanliness, health_check]

  # -------------------------
  # Content Substance
  # -------------------------
  content_substance:
    empty_segment_rate:
      display_name: Empty Segment Rate
      metric_type: rate
      target: 0.0
      operator: "=="
      blocking: true
      description: No empty segments allowed (zero-length text)
      tags: [substance, blocking, health_check]

    short_segment_rate:
      display_name: Short Segment Rate
      metric_type: rate
      target: 0.05
      operator: "<="
      warn_threshold: 0.10
      blocking: false
      description: Max 5% segments below minimum length (50 chars)
      tags: [substance, health_check]

    # Smart Integrity Check - File Size Validation
    min_file_size_kb:
      display_name: Minimum File Size (Strict Floor)
      metric_type: count
      target: 100
      operator: ">="
      blocking: true
      description: Raw HTML file must be >= 100 KB (below this indicates corrupt download)
      tags: [substance, size_validation, corrupt_data, blocking]
      unit: kilobytes

    max_file_size_mb_standard:
      display_name: Maximum File Size (Standard Industries)
      metric_type: count
      target: 50
      operator: "<="
      blocking: false
      description: Raw HTML file should be <= 50 MB for non-financial sectors (flags bloat)
      tags: [substance, size_validation, industry_standard]
      unit: megabytes

    max_file_size_mb_financial:
      display_name: Maximum File Size (Financials/REITs)
      metric_type: count
      target: 150
      operator: "<="
      blocking: false
      description: Raw HTML file allowed up to 150 MB for SIC 6000-6799 (asset tables)
      tags: [substance, size_validation, industry_specific, financials]
      unit: megabytes
      sic_range: [6000, 6799]

    extraction_yield_ppm:
      display_name: Extraction Yield (PPM)
      metric_type: count
      target: 1000
      operator: ">="
      blocking: false
      description: Parts-per-million ratio of extracted chars to file bytes (validates proportionality)
      tags: [substance, size_validation, extraction_efficiency]
      unit: ppm

    min_segment_count:
      display_name: Minimum Segment Count
      metric_type: count
      target: 1
      operator: ">="
      blocking: true
      description: Filing must have at least one extracted segment (zero means Item 1A not found)
      tags: [substance, blocking, health_check]

    over_limit_word_rate:
      display_name: Over-Limit Word Rate (>380 words)
      metric_type: rate
      target: 0.0
      operator: "<="
      warn_threshold: 0.05
      blocking: false
      description: >
        Fraction of segments exceeding the 380-word Option A ceiling (~512 tokens at
        1.35 tok/word). Target is 0.0 post-Option-A deployment. Values above 0.0 indicate
        Option A is not yet deployed (pre-deploy baseline is ~2.75%). Values above 0.05
        trigger the ModernBERT contingency review per PRD-002 ยง4.1 OQ-3 / RFC-003 OQ-RFC3-2.
      tags: [substance, token_safety, word_count, rfc003]

  # -------------------------
  # Domain Rules
  # -------------------------
  domain_rules:
    duplicate_rate:
      display_name: Duplicate Rate
      metric_type: rate
      target: 0.0
      operator: "=="
      blocking: true
      description: No duplicate filings allowed (hash-based detection)
      tags: [domain, blocking, health_check]

    risk_keyword_present:
      display_name: Risk Keyword Present
      metric_type: boolean
      target: true
      blocking: false
      description: Risk Factors section should contain risk-related keywords
      tags: [domain, health_check]

    segment_duplicate_rate:
      display_name: Segment Duplicate Rate
      metric_type: rate
      target: 0.15
      warn_threshold: 0.10
      operator: "<="
      blocking: false
      description: Rate of near-duplicate segments across all files (12-char SHA-256 prefix)
      tags: [domain, health_check]
